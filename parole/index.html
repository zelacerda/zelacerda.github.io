<html><head><title>Paro.le</title><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0, viewport-fit=cover">
<script type="text/javascript" src="../brython.js"></script>
<script type="text/javascript" src="../brython_stdlib.js"></script>
<link rel="stylesheet" type="text/css" href="parole.css"></head>
<body onload="brython()"></body></html>
<script type="text/python">

import time
from random import seed

from browser import document as doc
from browser import window, bind, timer
from browser.html import TABLE, TR, TD, DIV, SPAN, HR

from utils import get_letters, count2sec


def get_day_game():
    init_time = 1644116400 # 2022-02-06 00:00
    now = int(time.time())
    day_game = int((now - init_time) / 86400) + 1
    return day_game

def roll_dices(game):
    seed(game)
    letters = [get_letters(4) for _ in range(4)]
    return letters

def create_grid(letters):
    grid = TABLE()
    for row in range(4):
        grid <= TR(TD(DIV(letters[row][col], id=str(row)+str(col), Class="inactive")) for col in range(4))
    return grid

@bind("body", "click")
def muda_cor(event):
    """
    Handler  para alternar a cor de uma célula com números clicada.
    """
    element = event.target
    content = element.textContent
    if content != "":
        if element.class_name == "active":
            element.class_name = "inactive"
        elif element.class_name == "inactive":
            element.class_name = "active"

def update_timer():
    global count
    count -= 1
    if count > 0:
        doc["timer"].textContent = count2sec(count)
    else:
        doc["timer"].textContent = "Fim de jogo!"
        reset()


def reset():
    for row in range(4):
        for col in range(4):
            doc[f"{row}{col}"].textContent = ""
            doc[f"{row}{col}"].class_name = "inactive"


def main():
    game = get_day_game()
    letters = roll_dices(game)
    grid = create_grid(letters)
    doc <= SPAN("paro.le", id="title", Class="title")
    doc <= HR()
    doc <= grid
    doc <= SPAN("3:00", id="timer", Class="timer")


count = 180

main()

timer.set_interval(update_timer, 1000)

</script>