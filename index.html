<!doctype html>
<html>

<head>
    <title>Gerador de cartelas de bingo</title>
    <meta charset="utf-8">
    <script type="text/javascript" src="brython.js"></script>
    <script type="text/javascript" src="brython_stdlib.js"></script>
</head>

<style>

body{
    font-family: Arial, Helvetica, sans-serif;
    font-size: 32px;
    text-align: center;
}

button{
    font-size: 24px;
}

table{
    font-size: 45px;
    margin-left: auto;
    margin-right: auto;
}

td{
    background-color: #ccc;
    padding: 10px 10px 10px 10px;
    border-radius: 0.2em;
    text-align: center;
    cursor: default;
    width: 80px;
    height: 80px;
}

</style>

<body onload="brython()">

<h1>BINGO!</h1>

Clique
<button id="botao">aqui</button>
para gerar uma nova cartela de bingo.

<br><br>

<div id="ticket"></div><br>

<span id="codigo" style="display:none">CÃ³digo da cartela:
    <span id="ticket_no" style="font-weight: bold;"></span>
</span>

<script type="text/python">
import random
from browser import document, alert
from browser.html import TABLE, TR, TD


def generate_ticket(ticket_number=None):
    if ticket_number is None:
        ticket_number = random.randint(1, 9999)
    random.seed(ticket_number)

    valid = False

    while not valid:
        lines = [random.sample(range(9), 5) for _ in range(3)]
        tens_counts = [sum([d in line for line in lines]) for d in range(9)]
        if 0 not in tens_counts:
            valid = True

    pos = sorted([(c, i) for i, l in enumerate(lines) for c in l])

    numbers = []
    for tens, count in enumerate(tens_counts):
        if tens < 8:
            range_values = range(tens * 10 + 1, (tens + 1) * 10)
        else:
            range_values = range(81, 91)
        numbers.extend(random.sample(range_values, count))

    numbers = sorted(numbers)
    ticket = [[], [], []]
    for i, num in enumerate(numbers):
        ticket[pos[i][1]].append(num)

    return f'{ticket_number:04d}', ticket


def to_string(ticket):
    grid = [['' for j in range(9)] for i in range(3)]
    for line, numbers in enumerate(ticket):
        for number in numbers:
            if number == 90:
                column = 8
            else:
                column = int(number / 10)
            grid[line][column] = str(number)
    return grid


def cria_tabela(lista):
    tabela = TABLE()
    for row in range(3):
        tabela <= TR(TD(f"{lista[row][column]}") for column in range(9))
    return tabela


def clica(event):
    num, ticket = generate_ticket()
    numeros = to_string(ticket)
    document["ticket_no"].textContent = str(num)
    document["ticket"].clear()
    document["ticket"] <= cria_tabela(numeros)
    document["codigo"].style.display = "inline"

    for numero in document.select("td"):
        numero.bind("click", muda_cor)


def alterna_cor(color):
    if color == "rgb(0, 204, 0)":
        return "rgb(204, 204, 204)"
    else:
        return "rgb(0, 204, 0)"


def muda_cor(event):
    element = event.target
    content = element.textContent
    if content != "":
        color = element.style.backgroundColor
        element.style.backgroundColor = alterna_cor(color)


def inicio():
    global document
    tabela = TABLE()

    for row in range(3):
        tabela <= TR(TD() for column in range(9))

    document["ticket"] <= tabela
    document["botao"].bind("click", clica)


inicio()

</script>
</body>

</html>